function openModal(){document.querySelector(".modal-dialog").style.display="flex"}function closeModal(){document.querySelector(".modal-dialog").style.display="none"}API_URL="https://api.staging.estaly.co",ADD_TO_CART_CLASS_NAME="green-round-button-voltaire",OFFER_BUTTON_SELECTOR="",PDP_OFFERING_SELECTOR="",MODAL_DIALOG_SELECTOR="";const PDP={selectedPlanId:null,async init({variantReferenceId:e,merchantId:t}){if(!e)return;const a=await Estaly.getOffers(e,t),n=a.offers.filter((t=>t.productVariantId===e))[0].plans;return this.insertPlans(n),this.fillButtonsMarketing(a.marketing.buttons),this.initButtons(e),this.displayButtons(),Estaly.fillModalMarketing(a.marketing.modal),Estaly.initModal({afterAddToCartCallback:()=>{}},e),this},setButtonsState(e=""){document.querySelectorAll(`${e} .offer-button`).forEach((e=>{e.dataset.planVariantId==this.selectedPlanId?e.classList.add("active"):e.classList.remove("active")}))},fillButtonsMarketing(e){const t=document.querySelector(".estaly-pdp-offering");t&&(t.querySelector(".headline-buttons").innerText=e.headline,t.querySelector(".link-buttons").innerText=e.linkText)},initButtons(e){document.querySelectorAll(".offer-button").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.planVariantId==this.selectedPlanId?this.selectedPlanId=null:this.selectedPlanId=e.dataset.planVariantId,this.setButtonsState()}))}));document.querySelector(".link-buttons").addEventListener("click",(()=>{Estaly.openModal(!1)}));document.getElementsByClassName(ADD_TO_CART_CLASS_NAME)[0].addEventListener("click",(e=>{e.stopPropagation(),this.confirm_configurator_estaly(e)}))},displayButtons(){const e=document.querySelector(".estaly-pdp-offering");e&&(e.style.display="block")},insertPlans(e){if(0===e.length)return;document.querySelectorAll(".offer-button").forEach(((t,a)=>{const n=e[a%e.length];t.dataset.planVariantId=n.offerVariantId;t.querySelector(".offer-term-length").innerText=n.termLength;t.querySelector(".offer-price").innerText=n.price}))},addOfferToCart(e,t){if(null!=this.selectedPlanId){var a=[];a.push({id:this.selectedPlanId,qty:1}),$.ajax({type:"POST",url:"/wp-admin/admin-ajax.php",dataType:"JSON",data:{action:"multi_add_to_cart",items:a},success:function(){console.log("protection plan added")}})}},confirm_configurator_estaly(){var e=[];null==this.selectedPlanId||e.push({id:this.selectedPlanId,qty:1}),[":radio:checked",":checkbox:checked"].forEach((function(t){$(t).each((function(t,a){let n=parseInt($(a).attr("id"));$(a).attr("name");isNaN(n)||e.push({id:n,qty:1})})),$.ajax({type:"POST",url:"/wp-admin/admin-ajax.php",dataType:"JSON",data:{action:"multi_add_to_cart",items:e},success:function(e){window.location.href=e}})}))}},Estaly={Widgets:{PDP:PDP,add(e,t){e.init(t)}},state:{selectedOfferId:null},async getOffers(e,t){const a=`${API_URL}/offers?reference_ids=${e}`,n=await fetch(a,{headers:{Authorization:t}});return await n.json()},insertPlans(e){if(0===e.length)return;document.querySelectorAll(".offer-button").forEach(((t,a)=>{const n=e[a%e.length];t.dataset.planVariantId=n.offerVariantId;t.querySelector(".offer-term-length").innerText=n.termLength;t.querySelector(".offer-price").innerText=n.price}))},initModal({afterAddToCartCallback:e},t){const a=document.querySelectorAll(".modal-dialog .offer-button");a.forEach((e=>{e.addEventListener("click",(()=>{e.dataset.planVariantId==this.state.selectedOfferId?this.state.selectedOfferId=null:this.state.selectedOfferId=e.dataset.planVariantId,a.forEach((e=>{e.dataset.planVariantId==this.state.selectedOfferId?e.classList.add("active"):e.classList.remove("active")}))}))}));document.querySelector(".modal-dialog .close-estaly").addEventListener("click",this.closeModal);document.querySelector(".modal-dialog .button-submit").addEventListener("click",(()=>{null!=this.state.selectedOfferId?(this.closeModal(),e()):this.closeModal()}));document.getElementsByName("decline")[0].addEventListener("click",this.closeModal)},openModal(e){const t=document.querySelector(".modal-dialog");t.querySelector(".buttons-container").style.display=e?"block":"none",t.style.display="flex"},closeModal(){document.querySelector(".modal-dialog").style.display="none"},fillModalMarketing(e){const t=document.querySelector(".modal-dialog");if(t){t.querySelector("h2").innerText=e.headline,t.querySelector(".coverage-header").innerText=e.coverageBulletsHeading;t.querySelectorAll(".list .list-item").forEach(((t,a)=>{t.innerText=e.bulletPoints[a]})),t.querySelector(".terms-link").innerText=e.linkText,t.querySelector(".terms-link").href=e.planDetailsUrl,t.querySelector(".merchant-logo").src=e.merchantLogo,t.querySelector(".button-link").innerText=e.declineText,t.querySelector(".button-submit").innerText=e.buyText,t.querySelector(".offered-by").innerText=e.legalText,t.querySelector(".learn-more-image").src=e.image}}};
