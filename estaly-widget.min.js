function openModal(){document.querySelector(".modal-dialog").style.display="flex"}function closeModal(){document.querySelector(".modal-dialog").style.display="none"}API_URL="https://api.estaly.co",OFFER_BUTTON_SELECTOR="",PDP_OFFERING_SELECTOR="",MODAL_DIALOG_SELECTOR="";const PDP={selectedPlanId:null,async init({variantReferenceId:e,merchantId:t}){if(!e)return;const l=await Estaly.getOffers(e,t),n=l.offers.filter((t=>t.productVariantId===e))[0].plans;return this.insertPlans(n),this.fillButtonsMarketing(l.marketing.buttons),this.initButtons(e),this.displayButtons(),Estaly.fillModalMarketing(l.marketing.modal),Estaly.initModal({afterAddToCartCallback:()=>{}},e),this},setButtonsState(e=""){document.querySelectorAll(`${e} .offer-button`).forEach((e=>{e.dataset.planVariantId==this.selectedPlanId?e.classList.add("active"):e.classList.remove("active")}))},fillButtonsMarketing(e){const t=document.querySelector(".estaly-pdp-offering");t&&(t.querySelector(".link-buttons").innerText=e.linkText)},initButtons(e){document.querySelectorAll(".offer-button").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.planVariantId==this.selectedPlanId?this.selectedPlanId=null:this.selectedPlanId=e.dataset.planVariantId,this.setButtonsState()}))}));document.querySelector(".link-buttons").addEventListener("click",(()=>{Estaly.openModal(!1)}))},displayButtons(){const e=document.querySelector(".estaly-pdp-offering");e&&(e.style.display="block")},insertPlans(e){if(0===e.length)return;document.querySelectorAll(".offer-button").forEach(((t,l)=>{const n=e[l%e.length];t.dataset.planVariantId=n.offerVariantId;t.querySelector(".offer-term-length").innerText=n.termLength;t.querySelector(".offer-price").innerText=n.price}))}},Estaly={Widgets:{PDP:PDP,add(e,t){e.init(t)}},state:{selectedOfferId:null},async getOffers(e,t){const l=`${API_URL}/merchant/offers?reference_ids=${e}`,n=await fetch(l,{headers:{Authorization:t}});return await n.json()},insertPlans(e){if(0===e.length)return;document.querySelectorAll(".offer-button").forEach(((t,l)=>{const n=e[l%e.length];t.dataset.planVariantId=n.offerVariantId;t.querySelector(".offer-term-length").innerText=n.termLength;t.querySelector(".offer-price").innerText=n.price}))},initModal({afterAddToCartCallback:e},t){const l=document.querySelectorAll(".modal-dialog .offer-button");l.forEach((e=>{e.addEventListener("click",(()=>{e.dataset.planVariantId==this.state.selectedOfferId?this.state.selectedOfferId=null:this.state.selectedOfferId=e.dataset.planVariantId,l.forEach((e=>{e.dataset.planVariantId==this.state.selectedOfferId?e.classList.add("active"):e.classList.remove("active")}))}))}));document.querySelector(".modal-dialog .close-estaly").addEventListener("click",this.closeModal);document.getElementsByClassName("button-insur")[0].addEventListener("click",(()=>{document.getElementsByClassName("offer-button")[1].click(),this.closeModal()}));document.querySelector(".modal-dialog .button-submit").addEventListener("click",(()=>{null!=this.state.selectedOfferId?(this.closeModal(),e()):this.closeModal()}));document.getElementsByName("decline")[0].addEventListener("click",this.closeModal)},openModal(e){const t=document.querySelector(".modal-dialog");t.querySelector(".buttons-container").style.display=e?"block":"none",t.style.display="flex"},closeModal(){document.querySelector(".modal-dialog").style.display="none"},fillModalMarketing(e){const t=document.querySelector(".modal-dialog");if(t){t.querySelectorAll(".list .list-item").forEach(((t,l)=>{t.innerText=e.bulletPoints[l]})),t.querySelector(".terms-link").innerText=e.linkText,t.querySelector(".terms-link").href=e.planDetailsUrl,t.querySelector(".button-link").innerText=e.declineText,t.querySelector(".button-submit").innerText=e.buyText}}};
